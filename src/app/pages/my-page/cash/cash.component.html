<div>
  <div style="margin-bottom: 10px; text-align: right;">
    <label>현재 포인트 : <span style="font-weight: bold;">{{prevCash | number}}</span> </label>
    <button (click)="openModal(withDrawCashModal)">출금</button>
  </div>
  <app-user-grid *ngIf="data != undefined" [data]="data" [fields]="fields" [detailTemplate]="detailTemplate">
    <ng-template #detailTemplate let-dataItem>
      <div>
        <label>요청 자</label>
        <div>{{dataItem.userName}}</div>
      </div>
      <div>
        <label>요청 일자</label>
        <div>{{dataItem.withDrawDate}}</div>
      </div>
      <div>
        <label>지급 일</label>
        <div>{{dataItem.paymentDate}}</div>
      </div>
      <div>
        <label>지급 내용</label>
        <div>{{dataItem.content}}</div>
      </div>
      <div>
        <label>이전 금액</label>
        <div>{{dataItem.prevCash}}</div>
      </div>
      <div>
        <label>요청 금액</label>
        <div>{{dataItem.withDrawCash}}</div>
      </div>
      <div>
        <label>잔액</label>
        <div>{{dataItem.afterCash}}</div>
      </div>
      <div>
        <label>승인 여부</label>
        <div>{{dataItem.approval}}</div>
      </div>
    </ng-template>
  </app-user-grid>
</div>

<ng-template #withDrawCashModal>
  <div class="cash-request-header">
    <div>
      <app-logo-sx [refresh]="false"></app-logo-sx>
    </div>
    <div>
      <h2>출금 요청</h2>
    </div>
  </div>
  <div>
    <div>현재 잔액 {{prevCash | number}}</div>
  </div>
  <div class="cash-request-area">
    <form [formGroup]="form">
      <div class="form-select">
        <label><span style="color: red;">* </span>은행 명</label>
        <select (change)="selectChange($event.target)" formControlName="bank">
          <option *ngFor="let bank of banks" value="{{ bank.idx }}">{{ bank.name }}</option>
        </select>
        <span class="required-notice-red" *ngIf="form.controls.bank.hasError('required')">은행 명은 필수입니다.</span>
      </div>
      <div class="form-input-text">
        <label><span style="color: red;">* </span>계좌 번호</label>
        <input type="text" formControlName="account" />
        <span class="required-notice-red" *ngIf="form.controls.account.hasError('required')">계좌 번호는 필수입니다.</span>
      </div>
      <div class="form-input-text">
        <label><span style="color: red;">* </span>출금 금액</label>
        <input type="text" formControlName="withDrawCash" [max]="prevCash" (input)="checkPrevCash = prevCash - checkPrevCash" />
        <span class="required-notice-red" *ngIf="form.controls.withDrawCash.hasError('required')">출금 금액은 필수입니다.</span>
      </div>
    </form>
  </div>
  <div class="cash-request-fotter">
    <div>
      <div style="color: red;">* 최소 10,000 마일리지이상 출금이 가능합니다.</div>
      <div style="color: red;">* 입력한 계좌번호는 승인 및 최소 한 달 이내에 삭제될 예정입니다.</div>
    </div>
    <div class="form-input-text">
      <input type="checkbox" [(ngModel)]="checkWithDraw"/>
      <label>해당 정책에 동의 합니다.</label>
    </div>
    <div class="modal-footer modal-footer-one-btn">
      <button (click)="onRequest(form.controls)" [disabled]="!checkWithDraw && !form.valid && form.controls.withDrawCash.value < 10000 || form.controls.withDrawCash.value < prevCash">승인 요청</button>
    </div>
  </div>
</ng-template>
